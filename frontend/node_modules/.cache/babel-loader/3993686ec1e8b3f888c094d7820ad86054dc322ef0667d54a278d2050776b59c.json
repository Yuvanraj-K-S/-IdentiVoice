{"ast":null,"code":"const API_BASE = 'http://localhost:5000/api';\nconst validateAudioBlob = async blob => {\n  if (!blob) {\n    throw new Error('No audio data available');\n  }\n  if (!(blob instanceof Blob)) {\n    throw new Error('Invalid audio data format');\n  }\n  if (blob.size === 0) {\n    throw new Error('Audio file is empty');\n  }\n  if (blob.size < 44) {\n    throw new Error('Audio file too small to be valid WAV');\n  }\n\n  // Check WAV file format\n  const buffer = await blob.arrayBuffer();\n  const view = new DataView(buffer);\n\n  // Check RIFF header\n  const riffHeader = String.fromCharCode(view.getUint8(0), view.getUint8(1), view.getUint8(2), view.getUint8(3));\n  if (riffHeader !== 'RIFF') {\n    throw new Error('Invalid WAV file: missing RIFF header');\n  }\n\n  // Check WAVE format\n  const format = String.fromCharCode(view.getUint8(8), view.getUint8(9), view.getUint8(10), view.getUint8(11));\n  if (format !== 'WAVE') {\n    throw new Error('Invalid WAV file: missing WAVE format');\n  }\n\n  // Check fmt chunk\n  const fmtHeader = String.fromCharCode(view.getUint8(12), view.getUint8(13), view.getUint8(14), view.getUint8(15));\n  if (fmtHeader !== 'fmt ') {\n    throw new Error('Invalid WAV file: missing fmt chunk');\n  }\n\n  // Check audio format (1 = PCM)\n  const audioFormat = view.getUint16(20, true);\n  if (audioFormat !== 1) {\n    throw new Error('Invalid WAV file: must be PCM format');\n  }\n\n  // Check channels (must be mono)\n  const channels = view.getUint16(22, true);\n  if (channels !== 1) {\n    throw new Error('Invalid WAV file: must be mono channel');\n  }\n\n  // Check sample rate (must be 16kHz)\n  const sampleRate = view.getUint32(24, true);\n  if (sampleRate !== 16000) {\n    throw new Error('Invalid WAV file: sample rate must be 16kHz');\n  }\n\n  // Check bits per sample (must be 16-bit)\n  const bitsPerSample = view.getUint16(34, true);\n  if (bitsPerSample !== 16) {\n    throw new Error('Invalid WAV file: must be 16-bit');\n  }\n};\nexport const registerVoice = async (wavBlob, webmBlob, userData) => {\n  try {\n    if (!wavBlob || wavBlob.size === 0) {\n      throw new Error('WAV audio blob is empty or invalid');\n    }\n    if (!webmBlob || webmBlob.size === 0) {\n      throw new Error('WebM audio blob is empty or invalid');\n    }\n    // Validate blobs\n    if (!(wavBlob instanceof Blob) || !(webmBlob instanceof Blob)) {\n      throw new Error('Invalid audio data format');\n    }\n    const formData = new FormData();\n\n    // Append audio files\n    formData.append('wav_file', wavBlob, `${userData.username}_voice.wav`);\n    formData.append('webm_file', webmBlob, `${userData.username}_voice.webm`);\n\n    // Append user data as separate fields (not stringified)\n    const requiredFields = ['fullname', 'email', 'username', 'dob'];\n    for (const field of requiredFields) {\n      if (!userData[field]) {\n        throw new Error(`Missing required field: ${field}`);\n      }\n      formData.append(field, userData[field]);\n    }\n    const response = await fetch(`${API_BASE}/register`, {\n      method: 'POST',\n      body: formData,\n      credentials: 'include'\n    });\n    if (!response.ok) {\n      const error = await response.json().catch(() => null);\n      throw new Error((error === null || error === void 0 ? void 0 : error.message) || 'Registration failed');\n    }\n    return await response.json();\n  } catch (err) {\n    console.error('Registration error:', err);\n    return {\n      success: false,\n      message: err.message || 'Voice registration failed'\n    };\n  }\n};\nexport const loginVoice = async (audioBlob, username) => {\n  try {\n    await validateAudioBlob(audioBlob);\n    const formData = new FormData();\n    formData.append('audio', audioBlob, 'recording.wav');\n    formData.append('username', username);\n    const response = await fetch(`${API_BASE}/login`, {\n      method: 'POST',\n      body: formData,\n      mode: 'cors',\n      credentials: 'include'\n    });\n    if (!response.ok) {\n      const errorData = await response.json().catch(() => null);\n      throw new Error((errorData === null || errorData === void 0 ? void 0 : errorData.message) || `Server error: ${response.status}`);\n    }\n    const data = await response.json();\n    return data;\n  } catch (err) {\n    console.error('Login error:', err);\n    return {\n      success: false,\n      message: err.message || 'Failed to authenticate'\n    };\n  }\n};","map":{"version":3,"names":["API_BASE","validateAudioBlob","blob","Error","Blob","size","buffer","arrayBuffer","view","DataView","riffHeader","String","fromCharCode","getUint8","format","fmtHeader","audioFormat","getUint16","channels","sampleRate","getUint32","bitsPerSample","registerVoice","wavBlob","webmBlob","userData","formData","FormData","append","username","requiredFields","field","response","fetch","method","body","credentials","ok","error","json","catch","message","err","console","success","loginVoice","audioBlob","mode","errorData","status","data"],"sources":["C:/Users/Administrator/Desktop/-IdentiVoice/frontend/src/utils/api.js"],"sourcesContent":["const API_BASE = 'http://localhost:5000/api';\r\n\r\nconst validateAudioBlob = async (blob) => {\r\n    if (!blob) {\r\n        throw new Error('No audio data available');\r\n    }\r\n    if (!(blob instanceof Blob)) {\r\n        throw new Error('Invalid audio data format');\r\n    }\r\n    if (blob.size === 0) {\r\n        throw new Error('Audio file is empty');\r\n    }\r\n    if (blob.size < 44) {\r\n        throw new Error('Audio file too small to be valid WAV');\r\n    }\r\n\r\n    // Check WAV file format\r\n    const buffer = await blob.arrayBuffer();\r\n    const view = new DataView(buffer);\r\n    \r\n    // Check RIFF header\r\n    const riffHeader = String.fromCharCode(\r\n        view.getUint8(0),\r\n        view.getUint8(1),\r\n        view.getUint8(2),\r\n        view.getUint8(3)\r\n    );\r\n    if (riffHeader !== 'RIFF') {\r\n        throw new Error('Invalid WAV file: missing RIFF header');\r\n    }\r\n\r\n    // Check WAVE format\r\n    const format = String.fromCharCode(\r\n        view.getUint8(8),\r\n        view.getUint8(9),\r\n        view.getUint8(10),\r\n        view.getUint8(11)\r\n    );\r\n    if (format !== 'WAVE') {\r\n        throw new Error('Invalid WAV file: missing WAVE format');\r\n    }\r\n\r\n    // Check fmt chunk\r\n    const fmtHeader = String.fromCharCode(\r\n        view.getUint8(12),\r\n        view.getUint8(13),\r\n        view.getUint8(14),\r\n        view.getUint8(15)\r\n    );\r\n    if (fmtHeader !== 'fmt ') {\r\n        throw new Error('Invalid WAV file: missing fmt chunk');\r\n    }\r\n\r\n    // Check audio format (1 = PCM)\r\n    const audioFormat = view.getUint16(20, true);\r\n    if (audioFormat !== 1) {\r\n        throw new Error('Invalid WAV file: must be PCM format');\r\n    }\r\n\r\n    // Check channels (must be mono)\r\n    const channels = view.getUint16(22, true);\r\n    if (channels !== 1) {\r\n        throw new Error('Invalid WAV file: must be mono channel');\r\n    }\r\n\r\n    // Check sample rate (must be 16kHz)\r\n    const sampleRate = view.getUint32(24, true);\r\n    if (sampleRate !== 16000) {\r\n        throw new Error('Invalid WAV file: sample rate must be 16kHz');\r\n    }\r\n\r\n    // Check bits per sample (must be 16-bit)\r\n    const bitsPerSample = view.getUint16(34, true);\r\n    if (bitsPerSample !== 16) {\r\n        throw new Error('Invalid WAV file: must be 16-bit');\r\n    }\r\n};\r\n\r\nexport const registerVoice = async (wavBlob, webmBlob, userData) => {\r\n    try {\r\n        if (!wavBlob || wavBlob.size === 0) {\r\n            throw new Error('WAV audio blob is empty or invalid');\r\n        }\r\n        if (!webmBlob || webmBlob.size === 0) {\r\n            throw new Error('WebM audio blob is empty or invalid');\r\n        }\r\n        // Validate blobs\r\n        if (!(wavBlob instanceof Blob) || !(webmBlob instanceof Blob)) {\r\n            throw new Error('Invalid audio data format');\r\n        }\r\n\r\n        const formData = new FormData();\r\n        \r\n        // Append audio files\r\n        formData.append('wav_file', wavBlob, `${userData.username}_voice.wav`);\r\n        formData.append('webm_file', webmBlob, `${userData.username}_voice.webm`);\r\n        \r\n        // Append user data as separate fields (not stringified)\r\n        const requiredFields = ['fullname', 'email', 'username', 'dob'];\r\n        for (const field of requiredFields) {\r\n            if (!userData[field]) {\r\n                throw new Error(`Missing required field: ${field}`);\r\n            }\r\n            formData.append(field, userData[field]);\r\n        }\r\n\r\n        const response = await fetch(`${API_BASE}/register`, {\r\n            method: 'POST',\r\n            body: formData,\r\n            credentials: 'include'\r\n        });\r\n\r\n        if (!response.ok) {\r\n            const error = await response.json().catch(() => null);\r\n            throw new Error(error?.message || 'Registration failed');\r\n        }\r\n\r\n        return await response.json();\r\n        \r\n    } catch (err) {\r\n        console.error('Registration error:', err);\r\n        return { \r\n            success: false, \r\n            message: err.message || 'Voice registration failed' \r\n        };\r\n    }\r\n};  \r\n\r\nexport const loginVoice = async (audioBlob, username) => {\r\n    try {\r\n        await validateAudioBlob(audioBlob);\r\n        \r\n        const formData = new FormData();\r\n        formData.append('audio', audioBlob, 'recording.wav');\r\n        formData.append('username', username);\r\n        \r\n        const response = await fetch(`${API_BASE}/login`, {\r\n            method: 'POST',\r\n            body: formData,\r\n            mode: 'cors',\r\n            credentials: 'include'\r\n        });\r\n\r\n        if (!response.ok) {\r\n            const errorData = await response.json().catch(() => null);\r\n            throw new Error(errorData?.message || `Server error: ${response.status}`);\r\n        }\r\n        \r\n        const data = await response.json();\r\n        return data;\r\n        \r\n    } catch (err) {\r\n        console.error('Login error:', err);\r\n        return { \r\n            success: false, \r\n            message: err.message || 'Failed to authenticate' \r\n        };\r\n    }\r\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}